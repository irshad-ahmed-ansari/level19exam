"use strict";
(globalThis["webpackJsonp_yves_default"] = globalThis["webpackJsonp_yves_default"] || []).push([["quantity-counter"],{

/***/ "./src/Pyz/Yves/ShopUi/Theme/default/components/molecules/quantity-counter/quantity-counter.ts":
/*!*****************************************************************************************************!*\
  !*** ./src/Pyz/Yves/ShopUi/Theme/default/components/molecules/quantity-counter/quantity-counter.ts ***!
  \*****************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ QuantityCounter)
/* harmony export */ });
/* harmony import */ var ShopUi_models_component__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ShopUi/models/component */ "./vendor/spryker-shop/shop-ui/src/SprykerShop/Yves/ShopUi/Theme/default/models/component.ts");

class QuantityCounter extends ShopUi_models_component__WEBPACK_IMPORTED_MODULE_0__["default"] {
  constructor() {
    super(...arguments);
    this.incrementButton = void 0;
    this.decrementButton = void 0;
    this.input = void 0;
    this.value = void 0;
    this.duration = 1000;
    this.timeout = 0;
    this.numberOfDecimalPlaces = 10;
    this.formattedNumberInput = void 0;
  }
  readyCallback() {}
  init() {
    this.incrementButton = this.getElementsByClassName(this.jsName + "__button-increment")[0];
    this.decrementButton = this.getElementsByClassName(this.jsName + "__button-decrement")[0];
    this.input = this.getElementsByClassName(this.jsName + "__input")[0];
    this.formattedNumberInput = this.getElementsByClassName(this.jsName + "__formatted-input")[0];
    this.value = this.getValue;
    this.mapEvents();
  }
  mapEvents() {
    var _this$input;
    this.decrementButton.addEventListener('click', event => this.onChangeQuantity(event, 'decrease'));
    this.incrementButton.addEventListener('click', event => this.onChangeQuantity(event, 'increase'));
    (_this$input = this.input) == null ? void 0 : _this$input.addEventListener('keydown', event => this.onKeyDown(event));
    if (this.autoUpdate) {
      this.input.addEventListener('change', () => this.delayToSubmit());
    }
  }
  onChangeQuantity(event, type) {
    event.preventDefault();
    if (!this.isAvailable) {
      return;
    }
    var value = this.formattedNumberInput.unformattedValue;
    var step = this.step * this.precision;
    var calculatedValue = type === 'increase' ? value * this.precision + step : value * this.precision - step;
    var potentialValue = Number((calculatedValue / this.precision).toFixed(this.numberOfDecimalPlaces));
    var shouldUpdate = value < this.maxQuantity || potentialValue >= this.minQuantity;
    if (!shouldUpdate) {
      return;
    }
    this.input.value = potentialValue.toString();
    if (this.isAjaxMode) {
      this.delayToSubmit(true);
      return;
    }
    this.input.dispatchEvent(new Event('change'));
    this.input.dispatchEvent(new Event('input'));
  }
  delayToSubmit(triggerInput) {
    if (triggerInput === void 0) {
      triggerInput = false;
    }
    clearTimeout(this.timeout);
    this.timeout = window.setTimeout(() => {
      if (this.value === this.getValue) {
        return;
      }
      if (this.isAjaxMode && triggerInput) {
        this.input.dispatchEvent(new Event('input', {
          bubbles: true
        }));
        this.input.dispatchEvent(new Event('change', {
          bubbles: true
        }));
        return;
      }
      if (!this.isAjaxMode) {
        this.input.form.submit();
      }
    }, this.duration);
  }
  onKeyDown(event) {
    if (event.key === 'Enter') {
      event.preventDefault();
    }
  }
  get minQuantity() {
    return Number(this.input.getAttribute('min'));
  }
  get maxQuantity() {
    var max = Number(this.input.getAttribute('max'));
    return max > 0 && max > this.minQuantity ? max : Infinity;
  }
  get step() {
    var step = Number(this.input.getAttribute('step'));
    return step > 0 ? step : 1;
  }
  get getValue() {
    return Number(this.input.value);
  }
  get autoUpdate() {
    return this.input.hasAttribute('data-auto-update');
  }
  get isAvailable() {
    return !this.input.disabled && !this.input.readOnly;
  }
  get precision() {
    return Number("1" + '0'.repeat(this.numberOfDecimalPlaces));
  }
  get isAjaxMode() {
    return !!this.input.getAttribute('data-ajax-mode');
  }
}

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9qcy95dmVzX2RlZmF1bHQucXVhbnRpdHktY291bnRlci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUNnRDtBQUVqQyxNQUFNQyxlQUFlLFNBQVNELCtEQUFTLENBQUM7RUFBQUUsWUFBQTtJQUFBLFNBQUFDLFNBQUE7SUFBQSxLQUN6Q0MsZUFBZTtJQUFBLEtBQ2ZDLGVBQWU7SUFBQSxLQUNmQyxLQUFLO0lBQUEsS0FDTEMsS0FBSztJQUFBLEtBQ0xDLFFBQVEsR0FBRyxJQUFJO0lBQUEsS0FDZkMsT0FBTyxHQUFHLENBQUM7SUFBQSxLQUNYQyxxQkFBcUIsR0FBRyxFQUFFO0lBQUEsS0FDMUJDLG9CQUFvQjtFQUFBO0VBRXBCQyxhQUFhQSxDQUFBLEVBQVMsQ0FBQztFQUV2QkMsSUFBSUEsQ0FBQSxFQUFTO0lBQ25CLElBQUksQ0FBQ1QsZUFBZSxHQUFzQixJQUFJLENBQUNVLHNCQUFzQixDQUFJLElBQUksQ0FBQ0MsTUFBTSx1QkFBb0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM1RyxJQUFJLENBQUNWLGVBQWUsR0FBc0IsSUFBSSxDQUFDUyxzQkFBc0IsQ0FBSSxJQUFJLENBQUNDLE1BQU0sdUJBQW9CLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUcsSUFBSSxDQUFDVCxLQUFLLEdBQXFCLElBQUksQ0FBQ1Esc0JBQXNCLENBQUksSUFBSSxDQUFDQyxNQUFNLFlBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0RixJQUFJLENBQUNKLG9CQUFvQixHQUNyQixJQUFJLENBQUNHLHNCQUFzQixDQUFJLElBQUksQ0FBQ0MsTUFBTSxzQkFBbUIsQ0FBQyxDQUFDLENBQUMsQ0FDbkU7SUFDRCxJQUFJLENBQUNSLEtBQUssR0FBRyxJQUFJLENBQUNTLFFBQVE7SUFDMUIsSUFBSSxDQUFDQyxTQUFTLENBQUMsQ0FBQztFQUNwQjtFQUVVQSxTQUFTQSxDQUFBLEVBQVM7SUFBQSxJQUFBQyxXQUFBO0lBQ3hCLElBQUksQ0FBQ2IsZUFBZSxDQUFDYyxnQkFB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WSxDQUFDLGtCQUFrQixDQUFDO0VBQ3REO0VBRUEsSUFBYzFCLFdBQVdBLENBQUEsRUFBWTtJQUNqQyxPQUFPLENBQUMsSUFBSSxDQUFDckIsS0FBSyxDQUFDZ0QsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDaEQsS0FBSyxDQUFDaUQsUUFBUTtFQUN2RDtFQUVBLElBQWN6QixTQUFTQSxDQUFBLEVBQVc7SUFDOUIsT0FBT0csTUFBTSxPQUFLLEdBQUcsQ0FBQ3VCLE1BQU0sQ0FBQyxJQUFJLENBQUM5QyxxQkFBcUIsQ0FBRyxDQUFDO0VBQy9EO0VBRUEsSUFBYzZCLFVBQVVBLENBQUEsRUFBWTtJQUNoQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUNqQyxLQUFLLENBQUM0QyxZQUFZLENBQUMsZ0JBQWdCLENBQUM7RUFDdEQ7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL3NwcnlrZXItYjJiLWRlbW8tc2hvcC8uL3NyYy9QeXovWXZlcy9TaG9wVWkvVGhlbWUvZGVmYXVsdC9jb21wb25lbnRzL21vbGVjdWxlcy9xdWFudGl0eS1jb3VudGVyL3F1YW50aXR5LWNvdW50ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEZvcm1hdHRlZE51bWJlcklucHV0IGZyb20gJ1Nob3BVaS9jb21wb25lbnRzL21vbGVjdWxlcy9mb3JtYXR0ZWQtbnVtYmVyLWlucHV0L2Zvcm1hdHRlZC1udW1iZXItaW5wdXQnO1xuaW1wb3J0IENvbXBvbmVudCBmcm9tICdTaG9wVWkvbW9kZWxzL2NvbXBvbmVudCc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFF1YW50aXR5Q291bnRlciBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgcHJvdGVjdGVkIGluY3JlbWVudEJ1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgcHJvdGVjdGVkIGRlY3JlbWVudEJ1dHRvbjogSFRNTEJ1dHRvbkVsZW1lbnQ7XG4gICAgcHJvdGVjdGVkIGlucHV0OiBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHByb3RlY3RlZCB2YWx1ZTogbnVtYmVyO1xuICAgIHByb3RlY3RlZCBkdXJhdGlvbiA9IDEwMDA7XG4gICAgcHJvdGVjdGVkIHRpbWVvdXQgPSAwO1xuICAgIHByb3RlY3RlZCBudW1iZXJPZkRlY2ltYWxQbGFjZXMgPSAxMDtcbiAgICBwcm90ZWN0ZWQgZm9ybWF0dGVkTnVtYmVySW5wdXQ6IEZvcm1hdHRlZE51bWJlcklucHV0O1xuXG4gICAgcHJvdGVjdGVkIHJlYWR5Q2FsbGJhY2soKTogdm9pZCB7fVxuXG4gICAgcHJvdGVjdGVkIGluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaW5jcmVtZW50QnV0dG9uID0gPEhUTUxCdXR0b25FbGVtZW50PnRoaXMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShgJHt0aGlzLmpzTmFtZX1fX2J1dHRvbi1pbmNyZW1lbnRgKVswXTtcbiAgICAgICAgdGhpcy5kZWNyZW1lbnRCdXR0b24gPSA8SFRNTEJ1dHRvbkVsZW1lbnQ+dGhpcy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGAke3RoaXMuanNOYW1lfV9fYnV0dG9uLWRlY3JlbWVudGApWzBdO1xuICAgICAgICB0aGlzLmlucHV0ID0gPEhUTUxJbnB1dEVsZW1lbnQ+dGhpcy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGAke3RoaXMuanNOYW1lfV9faW5wdXRgKVswXTtcbiAgICAgICAgdGhpcy5mb3JtYXR0ZWROdW1iZXJJbnB1dCA9IDxGb3JtYXR0ZWROdW1iZXJJbnB1dD4oXG4gICAgICAgICAgICB0aGlzLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYCR7dGhpcy5qc05hbWV9X19mb3JtYXR0ZWQtaW5wdXRgKVswXVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5nZXRWYWx1ZTtcbiAgICAgICAgdGhpcy5tYXBFdmVudHMoKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgbWFwRXZlbnRzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmRlY3JlbWVudEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gdGhpcy5vbkNoYW5nZVF1YW50aXR5KGV2ZW50LCAnZGVjcmVhc2UnKSk7XG4gICAgICAgIHRoaXMuaW5jcmVtZW50QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB0aGlzLm9uQ2hhbmdlUXVhbnRpdHkoZXZlbnQsICdpbmNyZWFzZScpKTtcbiAgICAgICAgdGhpcy5pbnB1dD8uYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4gdGhpcy5vbktleURvd24oZXZlbnQpKTtcblxuICAgICAgICBpZiAodGhpcy5hdXRvVXBkYXRlKSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHRoaXMuZGVsYXlUb1N1Ym1pdCgpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBvbkNoYW5nZVF1YW50aXR5KGV2ZW50OiBFdmVudCwgdHlwZTogJ2RlY3JlYXNlJyB8ICdpbmNyZWFzZScpOiB2b2lkIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBpZiAoIXRoaXMuaXNBdmFpbGFibGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5mb3JtYXR0ZWROdW1iZXJJbnB1dC51bmZvcm1hdHRlZFZhbHVlO1xuICAgICAgICBjb25zdCBzdGVwID0gdGhpcy5zdGVwICogdGhpcy5wcmVjaXNpb247XG4gICAgICAgIGNvbnN0IGNhbGN1bGF0ZWRWYWx1ZSA9IHR5cGUgPT09ICdpbmNyZWFzZScgPyB2YWx1ZSAqIHRoaXMucHJlY2lzaW9uICsgc3RlcCA6IHZhbHVlICogdGhpcy5wcmVjaXNpb24gLSBzdGVwO1xuICAgICAgICBjb25zdCBwb3RlbnRpYWxWYWx1ZSA9IE51bWJlcigoY2FsY3VsYXRlZFZhbHVlIC8gdGhpcy5wcmVjaXNpb24pLnRvRml4ZWQodGhpcy5udW1iZXJPZkRlY2ltYWxQbGFjZXMpKTtcbiAgICAgICAgY29uc3Qgc2hvdWxkVXBkYXRlID0gdmFsdWUgPCB0aGlzLm1heFF1YW50aXR5IHx8IHBvdGVudGlhbFZhbHVlID49IHRoaXMubWluUXVhbnRpdHk7XG5cbiAgICAgICAgaWYgKCFzaG91bGRVcGRhdGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSBwb3RlbnRpYWxWYWx1ZS50b1N0cmluZygpO1xuXG4gICAgICAgIGlmICh0aGlzLmlzQWpheE1vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuZGVsYXlUb1N1Ym1pdCh0cnVlKTtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pbnB1dC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnY2hhbmdlJykpO1xuICAgICAgICB0aGlzLmlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdpbnB1dCcpKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZGVsYXlUb1N1Ym1pdCh0cmlnZ2VySW5wdXQgPSBmYWxzZSk6IHZvaWQge1xuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTtcbiAgICAgICAgdGhpcy50aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUgPT09IHRoaXMuZ2V0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQWpheE1vZGUgJiYgdHJpZ2dlcklucHV0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnaW5wdXQnLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NoYW5nZScsIHsgYnViYmxlczogdHJ1ZSB9KSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNBamF4TW9kZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcy5kdXJhdGlvbik7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG9uS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBtaW5RdWFudGl0eSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuaW5wdXQuZ2V0QXR0cmlidXRlKCdtaW4nKSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBtYXhRdWFudGl0eSgpOiBudW1iZXIge1xuICAgICAgICBjb25zdCBtYXggPSBOdW1iZXIodGhpcy5pbnB1dC5nZXRBdHRyaWJ1dGUoJ21heCcpKTtcblxuICAgICAgICByZXR1cm4gbWF4ID4gMCAmJiBtYXggPiB0aGlzLm1pblF1YW50aXR5ID8gbWF4IDogSW5maW5pdHk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBzdGVwKCk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IHN0ZXAgPSBOdW1iZXIodGhpcy5pbnB1dC5nZXRBdHRyaWJ1dGUoJ3N0ZXAnKSk7XG5cbiAgICAgICAgcmV0dXJuIHN0ZXAgPiAwID8gc3RlcCA6IDE7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBnZXRWYWx1ZSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuaW5wdXQudmFsdWUpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgYXV0b1VwZGF0ZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQuaGFzQXR0cmlidXRlKCdkYXRhLWF1dG8tdXBkYXRlJyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBpc0F2YWlsYWJsZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLmlucHV0LmRpc2FibGVkICYmICF0aGlzLmlucHV0LnJlYWRPbmx5O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgcHJlY2lzaW9uKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBOdW1iZXIoYDEkeycwJy5yZXBlYXQodGhpcy5udW1iZXJPZkRlY2ltYWxQbGFjZXMpfWApO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgaXNBamF4TW9kZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5pbnB1dC5nZXRBdHRyaWJ1dGUoJ2RhdGEtYWpheC1tb2RlJyk7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbIkNvbXBvbmVudCIsIlF1YW50aXR5Q291bnRlciIsImNvbnN0cnVjdG9yIiwiYXJndW1lbnRzIiwiaW5jcmVtZW50QnV0dG9uIiwiZGVjcmVtZW50QnV0dG9uIiwiaW5wdXQiLCJ2YWx1ZSIsImR1cmF0aW9uIiwidGltZW91dCIsIm51bWJlck9mRGVjaW1hbFBsYWNlcyIsImZvcm1hdHRlZE51bWJlcklucHV0IiwicmVhZHlDYWxsYmFjayIsImluaXQiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwianNOYW1lIiwiZ2V0VmFsdWUiLCJtYXBFdmVudHMiLCJfdGhpcyRpbnB1dCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsIm9uQ2hhbmdlUXVhbnRpdHkiLCJvbktleURvd24iLCJhdXRvVXBkYXRlIiwiZGVsYXlUb1N1Ym1pdCIsInR5cGUiLCJwcmV2ZW50RGVmYXVsdCIsImlzQXZhaWxhYmxlIiwidW5mb3JtYXR0ZWRWYWx1ZSIsInN0ZXAiLCJwcmVjaXNpb24iLCJjYWxjdWxhdGVkVmFsdWUiLCJwb3RlbnRpYWxWYWx1ZSIsIk51bWJlciIsInRvRml4ZWQiLCJzaG91bGRVcGRhdGUiLCJtYXhRdWFudGl0eSIsIm1pblF1YW50aXR5IiwidG9TdHJpbmciLCJpc0FqYXhNb2RlIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwidHJpZ2dlcklucHV0IiwiY2xlYXJUaW1lb3V0Iiwid2luZG93Iiwic2V0VGltZW91dCIsImJ1YmJsZXMiLCJmb3JtIiwic3VibWl0Iiwia2V5IiwiZ2V0QXR0cmlidXRlIiwibWF4IiwiSW5maW5pdHkiLCJoYXNBdHRyaWJ1dGUiLCJkaXNhYmxlZCIsInJlYWRPbmx5IiwicmVwZWF0Il0sInNvdXJjZVJvb3QiOiIifQ==