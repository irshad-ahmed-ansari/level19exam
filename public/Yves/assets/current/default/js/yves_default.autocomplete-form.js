"use strict";
(globalThis["webpackJsonp_yves_default"] = globalThis["webpackJsonp_yves_default"] || []).push([["autocomplete-form"],{

/***/ "./src/Pyz/Yves/ShopUi/Theme/default/components/molecules/autocomplete-form/autocomplete-form.ts":
/*!*******************************************************************************************************!*\
  !*** ./src/Pyz/Yves/ShopUi/Theme/default/components/molecules/autocomplete-form/autocomplete-form.ts ***!
  \*******************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ AutocompleteForm)
/* harmony export */ });
/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ "./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js");
/* harmony import */ var ShopUi_models_component__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ShopUi/models/component */ "./vendor/spryker-shop/shop-ui/src/SprykerShop/Yves/ShopUi/Theme/default/models/component.ts");
/* harmony import */ var ShopUi_components_molecules_main_overlay_main_overlay__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ShopUi/components/molecules/main-overlay/main-overlay */ "./vendor/spryker-shop/shop-ui/src/SprykerShop/Yves/ShopUi/Theme/default/components/molecules/main-overlay/main-overlay.ts");
/* harmony import */ var lodash_es_debounce__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! lodash-es/debounce */ "./node_modules/lodash-es/debounce.js");




class AutocompleteForm extends ShopUi_models_component__WEBPACK_IMPORTED_MODULE_1__["default"] {
  constructor() {
    super(...arguments);
    this.ajaxProvider = void 0;
    this.inputElement = void 0;
    this.hiddenInputElement = void 0;
    this.suggestionsContainer = void 0;
    this.cleanButton = void 0;
    this.eventShowOverlay = void 0;
    this.eventHideOverlay = void 0;
  }
  readyCallback() {}
  init() {
    this.ajaxProvider = this.getElementsByClassName(this.jsName + "__provider")[0];
    this.suggestionsContainer = this.getElementsByClassName(this.jsName + "__container")[0];
    this.inputElement = this.getElementsByClassName(this.jsName + "__input")[0];
    this.hiddenInputElement = this.getElementsByClassName(this.jsName + "__input-hidden")[0];
    this.cleanButton = this.getElementsByClassName(this.jsName + "__clean-button")[0];
    this.mapEvents();
  }
  mapEvents() {
    this.inputElement.addEventListener('input', (0,lodash_es_debounce__WEBPACK_IMPORTED_MODULE_3__["default"])(() => this.onInput(), this.debounceDelay));
    this.inputElement.addEventListener('blur', (0,lodash_es_debounce__WEBPACK_IMPORTED_MODULE_3__["default"])(() => this.onBlur(), this.debounceDelay));
    this.inputElement.addEventListener('focus', () => this.onFocus());
    if (this.showCleanButton) {
      this.cleanButton.addEventListener('click', () => this.onCleanButtonClick());
    }
    this.mapOverlayEvents();
  }
  onCleanButtonClick() {
    this.cleanFields();
  }
  onBlur() {
    this.toggleOverlay(false);
    this.hideSuggestions();
  }
  onFocus() {
    this.toggleOverlay(true);
    if (this.inputValue.length >= this.minLetters) {
      this.showSuggestions();
    }
  }
  onInput() {
    if (this.inputValue.length >= this.minLetters) {
      this.loadSuggestions();
      return;
    }
    this.hideSuggestions();
  }
  mapOverlayEvents() {
    var overlayConfig = {
      bubbles: true,
      detail: {
        id: this.name,
        zIndex: Number(getComputedStyle(this).zIndex) - 1
      }
    };
    this.eventShowOverlay = new CustomEvent(ShopUi_components_molecules_main_overlay_main_overlay__WEBPACK_IMPORTED_MODULE_2__.EVENT_SHOW_OVERLAY, overlayConfig);
    this.eventHideOverlay = new CustomEvent(ShopUi_components_molecules_main_overlay_main_overlay__WEBPACK_IMPORTED_MODULE_2__.EVENT_HIDE_OVERLAY, overlayConfig);
  }
  toggleOverlay(isShown) {
    this.dispatchEvent(isShown ? this.eventShowOverlay : this.eventHideOverlay);
    document.body.classList.toggle(this.bodyOverlayClassName, isShown);
  }
  showSuggestions() {
    this.suggestionsContainer.classList.remove('is-hidden');
  }
  hideSuggestions() {
    this.suggestionsContainer.classList.add('is-hidden');
  }
  loadSuggestions() {
    var _this = this;
    return (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      _this.showSuggestions();
      _this.ajaxProvider.queryParams.set(_this.queryParamName, _this.inputValue);
      yield _this.ajaxProvider.fetch();
      _this.mapItemEvents();
    })();
  }
  mapItemEvents() {
    var items = Array.from(this.suggestionsContainer.getElementsByClassName(this.itemClassName));
    items.forEach(item => {
      item.addEventListener('click', event => this.onItemClick(event));
    });
  }
  onItemClick(event) {
    var dataTarget = event.target;
    var data = dataTarget.getAttribute(this.valueDataAttribute);
    var text = dataTarget.textContent.trim();
    this.setInputs(data, text);
  }
  setInputs(data, text) {
    this.hiddenInputElement.value = data;
    this.inputElement.value = text;
  }
  cleanFields() {
    this.setInputs('', '');
  }
  get minLetters() {
    return Number(this.getAttribute('min-letters'));
  }
  get inputValue() {
    return this.inputElement.value.trim();
  }
  get queryParamName() {
    return this.getAttribute('query-param-name');
  }
  get valueDataAttribute() {
    return this.getAttribute('value-data-attribute');
  }
  get itemClassName() {
    return this.getAttribute('item-class-name');
  }
  get debounceDelay() {
    return Number(this.getAttribute('debounce-delay'));
  }
  get showCleanButton() {
    return this.hasAttribute('show-clean-button');
  }
  get bodyOverlayClassName() {
    return this.getAttribute('body-overlay-class-name');
  }
}

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9qcy95dmVzX2RlZmF1bHQuYXV0b2NvbXBsZXRlLWZvcm0uanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQWdEO0FBTWU7QUFDckI7QUFFM0IsTUFBTUksZ0JBQWdCLFNBQVNKLCtEQUFTLENBQUM7RUFBQUssWUFBQTtJQUFBLFNBQUFDLFNBQUE7SUFBQSxLQUMxQ0MsWUFBWTtJQUFBLEtBQ1pDLFlBQVk7SUFBQSxLQUNaQyxrQkFBa0I7SUFBQSxLQUNsQkMsb0JBQW9CO0lBQUEsS0FDcEJDLFdBQVc7SUFBQSxLQUNYQyxnQkFBZ0I7SUFBQSxLQUNoQkMsZ0JBQWdCO0VBQUE7RUFFaEJDLGFBQWFBLENBQUEsRUFBUyxDQUFDO0VBRXZCQyxJQUFJQSxDQUFBLEVBQVM7SUFDbkIsSUFBSSxDQUFDUixZQUFZLEdBQWlCLElBQUksQ0FBQ1Msc0JBQXNCLENBQUksSUFBSSxDQUFDQyxNQUFNLGVBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM1RixJQUFJLENBQUNQLG9CQUFvQixHQUFnQixJQUFJLENBQUNNLHNCQUFzQixDQUFJLElBQUksQ0FBQ0MsTUFBTSxnQkFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BHLElBQUksQ0FBQ1QsWUFBWSxHQUFxQixJQUFJLENBQUNRLHNCQUFzQixDQUFJLElBQUksQ0FBQ0MsTUFBTSxZQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDN0YsSUFBSSxDQUFDUixrQkFBa0IsR0FBcUIsSUFBSSxDQUFDTyxzQkFBc0IsQ0FBSSxJQUFJLENBQUNDLE1BQU0sbUJBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDMUcsSUFBSSxDQUFDTixXQUFXLEdBQXNCLElBQUksQ0FBQ0ssc0JBQXNCLENBQUksSUFBSSxDQUFDQyxNQUFNLG1CQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRXBHLElBQUksQ0FBQ0MsU0FBUyxDQUFDLENBQUM7RUFDcEI7RUFFVUEsU0FBU0EsQ0FBQSxFQUFTO0lBQ3hCLElBQUksQ0FBQ1YsWUFB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QUNoQixJQUFJLENBQUNpRCxTQUFTLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztFQUMxQjtFQUVBLElBQWM1QyxVQUFVQSxDQUFBLEVBQVc7SUFDL0IsT0FBT1MsTUFBTSxDQUFDLElBQUksQ0FBQzhCLFlBQVksQ0FBQyxhQUFhLENBQUMsQ0FBQztFQUNuRDtFQUVBLElBQWN6QyxVQUFVQSxDQUFBLEVBQVc7SUFDL0IsT0FBTyxJQUFJLENBQUN0QixZQUFZLENBQUNxRSxLQUFLLENBQUNGLElBQUksQ0FBQyxDQUFDO0VBQ3pDO0VBRUEsSUFBY2xCLGNBQWNBLENBQUEsRUFBVztJQUNuQyxPQUFPLElBQUksQ0FBQ2MsWUFBWSxDQUFDLGtCQUFrQixDQUFDO0VBQ2hEO0VBRUEsSUFBY0Msa0JBQWtCQSxDQUFBLEVBQVc7SUFDdkMsT0FBTyxJQUFJLENBQUNELFlBQVksQ0FBQyxzQkFBc0IsQ0FBQztFQUNwRDtFQUVBLElBQWNSLGFBQWFBLENBQUEsRUFBVztJQUNsQyxPQUFPLElBQUksQ0FBQ1EsWUFBWSxDQUFDLGlCQUFpQixDQUFDO0VBQy9DO0VBRUEsSUFBY2xELGFBQWFBLENBQUEsRUFBVztJQUNsQyxPQUFPb0IsTUFBTSxDQUFDLElBQUksQ0FBQzhCLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0VBQ3REO0VBRUEsSUFBYy9DLGVBQWVBLENBQUEsRUFBWTtJQUNyQyxPQUFPLElBQUksQ0FBQ3NELFlBQVksQ0FBQyxtQkFBbUIsQ0FBQztFQUNqRDtFQUVBLElBQWM1QixvQkFBb0JBLENBQUEsRUFBVztJQUN6QyxPQUFPLElBQUksQ0FBQ3FCLFlBQVksQ0FBQyx5QkFBeUIsQ0FBQztFQUN2RDtBQUNKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3ByeWtlci1iMmItZGVtby1zaG9wLy4vc3JjL1B5ei9ZdmVzL1Nob3BVaS9UaGVtZS9kZWZhdWx0L2NvbXBvbmVudHMvbW9sZWN1bGVzL2F1dG9jb21wbGV0ZS1mb3JtL2F1dG9jb21wbGV0ZS1mb3JtLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDb21wb25lbnQgZnJvbSAnU2hvcFVpL21vZGVscy9jb21wb25lbnQnO1xuaW1wb3J0IEFqYXhQcm92aWRlciBmcm9tICdTaG9wVWkvY29tcG9uZW50cy9tb2xlY3VsZXMvYWpheC1wcm92aWRlci9hamF4LXByb3ZpZGVyJztcbmltcG9ydCB7XG4gICAgRVZFTlRfSElERV9PVkVSTEFZLFxuICAgIEVWRU5UX1NIT1dfT1ZFUkxBWSxcbiAgICBPdmVybGF5RXZlbnREZXRhaWwsXG59IGZyb20gJ1Nob3BVaS9jb21wb25lbnRzL21vbGVjdWxlcy9tYWluLW92ZXJsYXkvbWFpbi1vdmVybGF5JztcbmltcG9ydCBkZWJvdW5jZSBmcm9tICdsb2Rhc2gtZXMvZGVib3VuY2UnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRvY29tcGxldGVGb3JtIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICBwcm90ZWN0ZWQgYWpheFByb3ZpZGVyOiBBamF4UHJvdmlkZXI7XG4gICAgcHJvdGVjdGVkIGlucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbiAgICBwcm90ZWN0ZWQgaGlkZGVuSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICAgIHByb3RlY3RlZCBzdWdnZXN0aW9uc0NvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gICAgcHJvdGVjdGVkIGNsZWFuQnV0dG9uOiBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICBwcm90ZWN0ZWQgZXZlbnRTaG93T3ZlcmxheTogQ3VzdG9tRXZlbnQ8T3ZlcmxheUV2ZW50RGV0YWlsPjtcbiAgICBwcm90ZWN0ZWQgZXZlbnRIaWRlT3ZlcmxheTogQ3VzdG9tRXZlbnQ8T3ZlcmxheUV2ZW50RGV0YWlsPjtcblxuICAgIHByb3RlY3RlZCByZWFkeUNhbGxiYWNrKCk6IHZvaWQge31cblxuICAgIHByb3RlY3RlZCBpbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmFqYXhQcm92aWRlciA9IDxBamF4UHJvdmlkZXI+dGhpcy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGAke3RoaXMuanNOYW1lfV9fcHJvdmlkZXJgKVswXTtcbiAgICAgICAgdGhpcy5zdWdnZXN0aW9uc0NvbnRhaW5lciA9IDxIVE1MRWxlbWVudD50aGlzLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYCR7dGhpcy5qc05hbWV9X19jb250YWluZXJgKVswXTtcbiAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQgPSA8SFRNTElucHV0RWxlbWVudD50aGlzLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYCR7dGhpcy5qc05hbWV9X19pbnB1dGApWzBdO1xuICAgICAgICB0aGlzLmhpZGRlbklucHV0RWxlbWVudCA9IDxIVE1MSW5wdXRFbGVtZW50PnRoaXMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShgJHt0aGlzLmpzTmFtZX1fX2lucHV0LWhpZGRlbmApWzBdO1xuICAgICAgICB0aGlzLmNsZWFuQnV0dG9uID0gPEhUTUxCdXR0b25FbGVtZW50PnRoaXMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShgJHt0aGlzLmpzTmFtZX1fX2NsZWFuLWJ1dHRvbmApWzBdO1xuXG4gICAgICAgIHRoaXMubWFwRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG1hcEV2ZW50cygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICdpbnB1dCcsXG4gICAgICAgICAgICBkZWJvdW5jZSgoKSA9PiB0aGlzLm9uSW5wdXQoKSwgdGhpcy5kZWJvdW5jZURlbGF5KSxcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICdibHVyJyxcbiAgICAgICAgICAgIGRlYm91bmNlKCgpID0+IHRoaXMub25CbHVyKCksIHRoaXMuZGVib3VuY2VEZWxheSksXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgKCkgPT4gdGhpcy5vbkZvY3VzKCkpO1xuXG4gICAgICAgIGlmICh0aGlzLnNob3dDbGVhbkJ1dHRvbikge1xuICAgICAgICAgICAgdGhpcy5jbGVhbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMub25DbGVhbkJ1dHRvbkNsaWNrKCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tYXBPdmVybGF5RXZlbnRzKCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG9uQ2xlYW5CdXR0b25DbGljaygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5jbGVhbkZpZWxkcygpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBvbkJsdXIoKTogdm9pZCB7XG4gICAgICAgIHRoaXMudG9nZ2xlT3ZlcmxheShmYWxzZSk7XG4gICAgICAgIHRoaXMuaGlkZVN1Z2dlc3Rpb25zKCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG9uRm9jdXMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMudG9nZ2xlT3ZlcmxheSh0cnVlKTtcblxuICAgICAgICBpZiAodGhpcy5pbnB1dFZhbHVlLmxlbmd0aCA+PSB0aGlzLm1pbkxldHRlcnMpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd1N1Z2dlc3Rpb25zKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgb25JbnB1dCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRWYWx1ZS5sZW5ndGggPj0gdGhpcy5taW5MZXR0ZXJzKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRTdWdnZXN0aW9ucygpO1xuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5oaWRlU3VnZ2VzdGlvbnMoKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgbWFwT3ZlcmxheUV2ZW50cygpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgb3ZlcmxheUNvbmZpZzogQ3VzdG9tRXZlbnRJbml0PE92ZXJsYXlFdmVudERldGFpbD4gPSB7XG4gICAgICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICAgICAgZGV0YWlsOiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMubmFtZSxcbiAgICAgICAgICAgICAgICB6SW5kZXg6IE51bWJlcihnZXRDb21wdXRlZFN0eWxlKHRoaXMpLnpJbmRleCkgLSAxLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmV2ZW50U2hvd092ZXJsYXkgPSBuZXcgQ3VzdG9tRXZlbnQoRVZFTlRfU0hPV19PVkVSTEFZLCBvdmVybGF5Q29uZmlnKTtcbiAgICAgICAgdGhpcy5ldmVudEhpZGVPdmVybGF5ID0gbmV3IEN1c3RvbUV2ZW50KEVWRU5UX0hJREVfT1ZFUkxBWSwgb3ZlcmxheUNvbmZpZyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHRvZ2dsZU92ZXJsYXkoaXNTaG93bjogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoaXNTaG93biA/IHRoaXMuZXZlbnRTaG93T3ZlcmxheSA6IHRoaXMuZXZlbnRIaWRlT3ZlcmxheSk7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnRvZ2dsZSh0aGlzLmJvZHlPdmVybGF5Q2xhc3NOYW1lLCBpc1Nob3duKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc2hvd1N1Z2dlc3Rpb25zKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN1Z2dlc3Rpb25zQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWhpZGRlbicpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBoaWRlU3VnZ2VzdGlvbnMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3VnZ2VzdGlvbnNDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaXMtaGlkZGVuJyk7XG4gICAgfVxuXG4gICAgYXN5bmMgbG9hZFN1Z2dlc3Rpb25zKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0aGlzLnNob3dTdWdnZXN0aW9ucygpO1xuICAgICAgICB0aGlzLmFqYXhQcm92aWRlci5xdWVyeVBhcmFtcy5zZXQodGhpcy5xdWVyeVBhcmFtTmFtZSwgdGhpcy5pbnB1dFZhbHVlKTtcblxuICAgICAgICBhd2FpdCB0aGlzLmFqYXhQcm92aWRlci5mZXRjaCgpO1xuICAgICAgICB0aGlzLm1hcEl0ZW1FdmVudHMoKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgbWFwSXRlbUV2ZW50cygpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaXRlbXMgPSBBcnJheS5mcm9tKHRoaXMuc3VnZ2VzdGlvbnNDb250YWluZXIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSh0aGlzLml0ZW1DbGFzc05hbWUpKTtcbiAgICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbTogSFRNTEVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQ6IEV2ZW50KSA9PiB0aGlzLm9uSXRlbUNsaWNrKGV2ZW50KSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBvbkl0ZW1DbGljayhldmVudDogRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgZGF0YVRhcmdldCA9IDxIVE1MRWxlbWVudD5ldmVudC50YXJnZXQ7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBkYXRhVGFyZ2V0LmdldEF0dHJpYnV0ZSh0aGlzLnZhbHVlRGF0YUF0dHJpYnV0ZSk7XG4gICAgICAgIGNvbnN0IHRleHQgPSBkYXRhVGFyZ2V0LnRleHRDb250ZW50LnRyaW0oKTtcblxuICAgICAgICB0aGlzLnNldElucHV0cyhkYXRhLCB0ZXh0KTtcbiAgICB9XG5cbiAgICBzZXRJbnB1dHMoZGF0YTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5oaWRkZW5JbnB1dEVsZW1lbnQudmFsdWUgPSBkYXRhO1xuICAgICAgICB0aGlzLmlucHV0RWxlbWVudC52YWx1ZSA9IHRleHQ7XG4gICAgfVxuXG4gICAgY2xlYW5GaWVsZHMoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2V0SW5wdXRzKCcnLCAnJyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBtaW5MZXR0ZXJzKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBOdW1iZXIodGhpcy5nZXRBdHRyaWJ1dGUoJ21pbi1sZXR0ZXJzJykpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgaW5wdXRWYWx1ZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnB1dEVsZW1lbnQudmFsdWUudHJpbSgpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgcXVlcnlQYXJhbU5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKCdxdWVyeS1wYXJhbS1uYW1lJyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCB2YWx1ZURhdGFBdHRyaWJ1dGUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKCd2YWx1ZS1kYXRhLWF0dHJpYnV0ZScpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgaXRlbUNsYXNzTmFtZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdHRyaWJ1dGUoJ2l0ZW0tY2xhc3MtbmFtZScpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgZGVib3VuY2VEZWxheSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuZ2V0QXR0cmlidXRlKCdkZWJvdW5jZS1kZWxheScpKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IHNob3dDbGVhbkJ1dHRvbigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzQXR0cmlidXRlKCdzaG93LWNsZWFuLWJ1dHRvbicpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgYm9keU92ZXJsYXlDbGFzc05hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKCdib2R5LW92ZXJsYXktY2xhc3MtbmFtZScpO1xuICAgIH1cbn1cbiJdLCJuYW1lcyI6WyJDb21wb25lbnQiLCJFVkVOVF9ISURFX09WRVJMQVkiLCJFVkVOVF9TSE9XX09WRVJMQVkiLCJkZWJvdW5jZSIsIkF1dG9jb21wbGV0ZUZvcm0iLCJjb25zdHJ1Y3RvciIsImFyZ3VtZW50cyIsImFqYXhQcm92aWRlciIsImlucHV0RWxlbWVudCIsImhpZGRlbklucHV0RWxlbWVudCIsInN1Z2dlc3Rpb25zQ29udGFpbmVyIiwiY2xlYW5CdXR0b24iLCJldmVudFNob3dPdmVybGF5IiwiZXZlbnRIaWRlT3ZlcmxheSIsInJlYWR5Q2FsbGJhY2siLCJpbml0IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImpzTmFtZSIsIm1hcEV2ZW50cyIsImFkZEV2ZW50TGlzdGVuZXIiLCJvbklucHV0IiwiZGVib3VuY2VEZWxheSIsIm9uQmx1ciIsIm9uRm9jdXMiLCJzaG93Q2xlYW5CdXR0b24iLCJvbkNsZWFuQnV0dG9uQ2xpY2siLCJtYXBPdmVybGF5RXZlbnRzIiwiY2xlYW5GaWVsZHMiLCJ0b2dnbGVPdmVybGF5IiwiaGlkZVN1Z2dlc3Rpb25zIiwiaW5wdXRWYWx1ZSIsImxlbmd0aCIsIm1pbkxldHRlcnMiLCJzaG93U3VnZ2VzdGlvbnMiLCJsb2FkU3VnZ2VzdGlvbnMiLCJvdmVybGF5Q29uZmlnIiwiYnViYmxlcyIsImRldGFpbCIsImlkIiwibmFtZSIsInpJbmRleCIsIk51bWJlciIsImdldENvbXB1dGVkU3R5bGUiLCJDdXN0b21FdmVudCIsImlzU2hvd24iLCJkaXNwYXRjaEV2ZW50IiwiZG9jdW1lbnQiLCJib2R5IiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwiYm9keU92ZXJsYXlDbGFzc05hbWUiLCJyZW1vdmUiLCJhZGQiLCJfdGhpcyIsIl9hc3luY1RvR2VuZXJhdG9yIiwicXVlcnlQYXJhbXMiLCJzZXQiLCJxdWVyeVBhcmFtTmFtZSIsImZldGNoIiwibWFwSXRlbUV2ZW50cyIsIml0ZW1zIiwiQXJyYXkiLCJmcm9tIiwiaXRlbUNsYXNzTmFtZSIsImZvckVhY2giLCJpdGVtIiwiZXZlbnQiLCJvbkl0ZW1DbGljayIsImRhdGFUYXJnZXQiLCJ0YXJnZXQiLCJkYXRhIiwiZ2V0QXR0cmlidXRlIiwidmFsdWVEYXRhQXR0cmlidXRlIiwidGV4dCIsInRleHRDb250ZW50IiwidHJpbSIsInNldElucHV0cyIsInZhbHVlIiwiaGFzQXR0cmlidXRlIl0sInNvdXJjZVJvb3QiOiIifQ==